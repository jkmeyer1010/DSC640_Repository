(()=>{var D=function(){function c(){}return c.prototype.createIframe=function(e){this.iframe=document.createElement("iframe"),this.iframe.name="coview-class-references",this.iframe.src="about:blank",e.appendChild(this.iframe);var t=this.iframe.contentWindow;t.Array.name&&(this.array=t.Array),t.String.name&&(this.string=t.String),this.iframe.style.display="none"},c.prototype.createXmlHttpRequest=function(e){if(!this.iframe||!this.iframe.parentElement||!this.iframe.contentWindow)return new XMLHttpRequest(e);var t=this.iframe.contentWindow;return new t.XMLHttpRequest(e)},c.prototype.removeIframe=function(){!this.iframe||(this.iframe.parentElement&&this.iframe.parentElement.removeChild(this.iframe),this.iframe=null)},c}(),A=new D;var F=class{};var H=class{constructor(){this.className=H.CLASS_NAME}},E=H;E.CLASS_NAME="com.coview.client.api.customer.CustomerCredentials";var l=class{constructor(){this.preferSubDomains=!1}setCookie(e,t,i,r,n,a){let s;i&&i.length>0?s="path="+i+";":s="path=/;";let C="";n&&n.length>0&&(C="SameSite="+n+";");let w="";a&&(w="Secure;");let x=this.getCookieName(e),k=null;x.indexOf("standalone")!==-1||r==null?k="expires=Session;":k="expires="+r.toUTCString()+";";let W=t==null;W&&(t="");let P=this.extractDomains();for(let K of P)if(document.cookie=x+"="+t+"; domain="+K+";"+k+s+w+C,!W&&this.getCookieWithoutSuffix(x)!=null)return!0;return!1}clearCookie(e,t){let i=new Date;i.setTime(0),this.setCookie(e,null,t,i,null,!1)}getCookie(e){return this.getCookieWithoutSuffix(this.getCookieName(e))}getCookieWithoutSuffix(e){e=e+"=";let t=document.cookie.split(";");for(let i of t){for(;i.charAt(0)===" ";)i=i.substring(1);if(i.indexOf(e)===0){let r=i.substring(e.length,i.length);if(r.length>0)return r}}return null}getCookieName(e){return this.cookieSuffix!=null?e+"-"+this.cookieSuffix:e}extractDomains(){let e=new Array,t=window.location.hostname;t.indexOf("www.")===0&&(t=t.substring(4)),t.indexOf(":")!==-1&&(t=t.split(":")[0]);let i=t.split(".");for(let r=i.length-2;0<=r;r--)e.push(i.slice(r).join("."));return e.length===0&&e.push(t),this.preferSubDomains?e.reverse():e}resolveAndSetCookieSuffix(e,t){window.location.search.indexOf("cov-standalone")!==-1?this.cookieSuffix="standalone":t!=null?this.cookieSuffix=t:this.cookieSuffix=""}setPreferSubDomains(e){this.preferSubDomains=e}};l.CUSTOMER_JWT_COOKIE_NAME="X-JWT",l.AGENT_FREE_BROWSE_JWT_COOKIE_NAME="X-AGENT-FREEBROWSE-TOKEN",l.JWT_ACCESS_COOKIE_NAME="X-JWT";var Z=new l;var S;(function(n){n.remoteLogging="remoteLogging",n.remoteLoggingDebug="remoteLoggingDebug",n.consoleDebug="consoleDebug",n.cobrowseClientResourceUpload="cobrowseClientResourceUpload",n.disableWebsocket="disableWebsocket"})(S||(S={}));var u=class{static getEnabledFeatures(){return u.enabledFeatures}static setEnabledFeatures(e){u.enabledFeatures=e}static isEnabled(e){return u.enabledFeatures?u.checkIsEnabled(e,u.enabledFeatures):u.checkIsEnabled(e,u.fallbackEnabedFatures)}static checkIsEnabled(e,t){return t.indexOf(e)!==-1}static isLoaded(){return u.enabledFeatures!=null}},y=u;y.enabledFeatures=null,y.fallbackEnabedFatures=[S.remoteLogging];var d=class{static isIntercomInstalled(){return window.Intercom!=null}trackEvent(e,t){this.intercom()("trackEvent",e,t)}update(e){this.intercom()("update",e)}updateIntercom(){let e={nounce:Date.now()};this.intercom()("update",e)}showMessages(){this.intercom()("showMessages")}hide(){this.intercom()("hide")}onHide(e){this.intercom()("onHide",e)}show(){this.intercom()("show")}intercom(){return window.Intercom}};var U=class{};var B=class extends U{constructor(){super();this.type=B.TYPE}},M=B;M.TYPE="coview-startIFrameConnectionPostEvent";var p=class{static toBoolean(e){return e==null?!1:typeof e=="boolean"?e:e==="true"}static $$apply(e,t){if(t.length===0)return e();if(t.length===1)return e(t[0]);if(t.length===2)return e(t[0],t[1]);if(t.length===3)return e(t[0],t[1],t[2]);if(t.length===4)return e(t[0],t[1],t[2],t[3]);throw new Error("Too many arguments: "+t.length)}};var v=class{constructor(){this.showButton=!1}static normalize(e){let t=new v;return t.showButton=p.toBoolean(e.showButton),t}};var O=class{constructor(){this.intercom=!1}static normalize(e){let t=new O;return t.intercom=p.toBoolean(e.intercom),t}};var b=class{constructor(){this.publicPage=!1;this.bindConsole=!1;this.skipTracking=!1}canShowButton(){return this.chat==null||this.chat.showButton}getCredentials(){let e=this.user;return e!=null&&(e.id==null||e.id==="")&&(e=null),e}static normalize(e){let t=new b;return Object.keys(e).forEach(i=>{let r=i.toString();t[r]=e[r]}),t.publicPage=p.toBoolean(t.publicPage),t.bindConsole=p.toBoolean(t.bindConsole),t.skipTracking=p.toBoolean(t.skipTracking),e.chat&&(t.chat=v.normalize(e.chat)),e.integrations&&(t.integrations=O.normalize(e.integrations)),t}};var g=class{listenToUrlChange(e){this.checkPushStates(e),this.checkHashes(e)}removeUrlChangeListener(){this.hashChangeListener!=null&&(window.removeEventListener(g.HASH_CHANGE_EVENT,this.hashChangeListener),this.hashChangeListener=null),this.pushState!=null&&(history[g.PUSH_STATE]=this.pushState)}checkPushStates(e){if(this.pushState=history[g.PUSH_STATE],this.pushState!=null){let t=this;history[g.PUSH_STATE]=function(){let i=arguments;try{t.fireUrlChangeEvent(i[2],"PUSH_STATE",e)}catch(r){}return t.pushState.apply(history,arguments)}}}checkHashes(e){this.hashChangeListener=()=>{this.fireUrlChangeEvent(window.location.href,"HASH",e)},window.addEventListener(g.HASH_CHANGE_EVENT,this.hashChangeListener)}fireUrlChangeEvent(e,t,i){e.indexOf("/")===0&&(e=window.location.origin+e),e!==this.currentUrl&&(this.currentUrl=e,i(e,t))}},I=g;I.HASH_CHANGE_EVENT="hashchange",I.PUSH_STATE="pushState";var ue=new I;var j=class{static stringify(e){return JSON.stringify(e,(t,i)=>{if(i!=null)return i})}};var N=window.coview;var R=class{constructor(e,t=!1){let i=this.createButton(e);t&&this.loadScriptOnClick(i)}createButton(e){this.addChatButtonStyleToHead(e);let t=document.createElement("div"),i=document.createElement("div");return i.className="cov cov-position-container",t.style.display="none",t.className="cov cov-chat-button",t.innerHTML="<div class='cov cov-launcher-icon cov-launcher-icon-chat'><div class='cov cov-launcher-icon-chat-dot cov-launcher-icon-chat-dot1'></div><div class='cov cov-launcher-icon-chat-dot cov-launcher-icon-chat-dot2'></div><div class='cov cov-launcher-icon-chat-dot cov-launcher-icon-chat-dot3'></div></div>",i.appendChild(t),document.getElementById("coview-container").appendChild(i),t}loadScriptOnClick(e){this.launcherClickListener=()=>{e.removeEventListener("click",this.launcherClickListener),N("openWidget")},e.addEventListener("click",this.launcherClickListener),e.style.display="block"}addChatButtonStyleToHead(e){let t=`
.cov.cov-chat-button { z-index: 100; position: absolute; bottom: 0px; right: 0px; width: 60px; height: 60px; border-radius: 50%; background-color: ${e}; cursor: pointer; opacity: 1; transition: transform 0.2s ease, opacity 0.2s ease; animation-name: enterScreen; animation-duration: 0.5s; animation-timing-function: ease; box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.35); }
.cov.cov-launcher-icon { width: 100%; height: 100%; background-position: center center; background-repeat: no-repeat; position: absolute; transition: transform 0.2s; opacity: 1; color: #2F80ED; background-image: url('data:image/png;base64,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'); background-size: 60px; }
.cov.cov-launcher-icon-chat-dot { width: 4px; height: 4px; background-color: ${e}; position: absolute; top: 28px; opacity: 0; animation-name: fadeMeIn; animation-duration: 0.5s; animation-fill-mode: forwards; animation-timing-function: ease; border-radius: 2px; } 
.cov.cov-launcher-icon-chat-dot1 { left: 21px; animation-delay: 0.1s; }
.cov.cov-launcher-icon-chat-dot2 { left: 28px; animation-delay: 0.2s; }
.cov.cov-launcher-icon-chat-dot3 { left: 35px; animation-delay: 0.3s; }
@keyframes fadeMeIn { 0% {opacity:0; transform:scale(0); } 100% {opacity:1; transform:scale(1); }}
@keyframes enterScreen { 0% { opacity:0; transform:scale(0.6) rotate(-45deg);} 100% { opacity:1; transform:scale(1); }}
.cov.cov-position-container { position: fixed; bottom: 20px; right: 20px; z-index: 2147483647;}
@media (max-width: 767px) { .cov.cov-position-container { bottom:20px;	right:20px; }}
html > body .cov { box-sizing: border-box; box-shadow: none; outline: none; color: inherit; float: none; background: none; padding: 0px; margin: 0px; border-radius: 0px; font-family: 'Lato', sans-serif; min-height: 0px; text-align: left; line-height: 100%; word-break: normal; }
`,i=document.createElement("style");i.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(i)}};var o=class{constructor(e){this.requestFound=!1;this.api=new d,this.api.onHide(()=>{this.stopIFrameMutationObserver(),this.elementWithNameExists(o.INTERCOM_BORDERLESS_FRAME)&&this.startMutationObserver(o.INTERCOM_BORDERLESS_FRAME)}),this.intervalHandle=setInterval(()=>{this.requestFound&&(e.onRequestFound(),this.requestFound=!1),this.foundUserId!=null&&(e.onUserIdFound(this.foundUserId),this.foundUserId=null)},200),this.bodyClickListener=()=>{this.frameClicked=performance.now(),this.foundConversationId!=null&&e.onConversationIdFound(this.foundConversationId)},this.startObservers()}startObservers(){this.startWatchingIntercomIframe(),this.startBodyIntercomIFrameObserver()}startWatchingIntercomIframe(){this.elementWithNameExists(o.INTERCOM_MESSENGER_FRAME)?this.startMutationObserver(o.INTERCOM_MESSENGER_FRAME):this.elementWithNameExists(o.INTERCOM_MESSENGER_LOADING_FRAME)?this.startMutationObserver(o.INTERCOM_MESSENGER_LOADING_FRAME):this.elementWithNameExists(o.INTERCOM_BORDERLESS_FRAME)&&this.startMutationObserver(o.INTERCOM_BORDERLESS_FRAME)}elementWithNameExists(e){return document.getElementsByName(e).length>0}shutdown(){this.stopIFrameMutationObserver(),this.stopIntercomContainerObserver(),clearInterval(this.intervalHandle)}stopIntercomContainerObserver(){this.intercomContainerObserver!=null&&this.intercomContainerObserver.disconnect(),this.intercomContainerObserver=null}stopIFrameMutationObserver(){this.iframeObserver!=null&&(this.iframeObserver.disconnect(),this.currentObservedIframeBody!=null&&this.currentObservedIframeBody.removeEventListener("click",this.bodyClickListener)),this.iframeObserver=null}startMutationObserver(e){this.stopIFrameMutationObserver();let t=document.getElementsByName(e)[0];this.iframeObserver=new MutationObserver(i=>this.onIFrameMutation(i)),this.currentObservedIframeBody=t.contentDocument.body,this.currentObservedIframeBody.addEventListener("click",this.bodyClickListener,!0),this.handleFoundCoviewImages(this.currentObservedIframeBody),this.iframeObserver.observe(this.currentObservedIframeBody,{childList:!0,subtree:!0})}startBodyIntercomIFrameObserver(){document.getElementById(o.INTERCOM_CONTAINER)==null?setTimeout(()=>{this.startBodyIntercomIFrameObserver()},1e3):(this.stopIntercomContainerObserver(),this.startWatchingIntercomIframe(),this.intercomContainerObserver=new MutationObserver(e=>this.onIntercomContainerMutation(e)),this.intercomContainerObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0}))}onIFrameMutation(e){for(let t of e){for(let i of t.addedNodes)i.nodeType===i.ELEMENT_NODE&&this.handleFoundCoviewImages(i);t.target!=null&&t.target.nodeType===t.target.ELEMENT_NODE&&this.handleFoundCoviewImages(t.target)}}handleFoundCoviewImages(e){let t=e.querySelectorAll("img[src*='coview.com']");for(let i of t){let r=i.src;if(r.indexOf("#")!==-1){let n=r.split("#")[1];if(n.indexOf("&")!==-1){let a=n.split("&");for(let s of a)this.findIds(s)}else this.findIds(n)}else this.requestFound=!0}}findIds(e){e.indexOf("conversation")!==-1?this.foundConversationId=e.split("conversation=").join(""):this.frameClicked!=null&&performance.now()-this.frameClicked<o.ALLOWED_CLICK_TO_CALLBACK_TIME_DIFFERENCE_IN_MS&&(this.foundUserId=e.split("customer=").join(""))}onIntercomContainerMutation(e){for(let t of e)for(let i of t.addedNodes)if(i.nodeType===i.ELEMENT_NODE){let r=i.getElementsByTagName("iframe"),n=[];i.nodeName==="IFRAME"&&n.push(i);for(let a of r)n.push(a);for(let a of n)a.getAttribute("name")===o.INTERCOM_BORDERLESS_FRAME?this.startMutationObserver(o.INTERCOM_BORDERLESS_FRAME):a.getAttribute("name")===o.INTERCOM_MESSENGER_FRAME?this.startMutationObserver(o.INTERCOM_MESSENGER_FRAME):a.getAttribute("name")===o.INTERCOM_MESSENGER_LOADING_FRAME&&this.startMutationObserver(o.INTERCOM_MESSENGER_LOADING_FRAME)}}},f=o;f.INTERCOM_MESSENGER_FRAME="intercom-messenger-frame",f.INTERCOM_MESSENGER_LOADING_FRAME="intercom-messenger-loading-frame",f.INTERCOM_BORDERLESS_FRAME="intercom-borderless-frame",f.INTERCOM_CONTAINER="intercom-container",f.ALLOWED_CLICK_TO_CALLBACK_TIME_DIFFERENCE_IN_MS=5e3;var L=class{constructor(e){this.intercomHeartbeatHandle=null;this.launcher=e}isIntercomInstalled(){return d.isIntercomInstalled()}isIntercomEnabled(e){if(e.integrations!=null){for(let t of e.integrations)if(t==="INTERCOM")return!0}return!1}waitForIntercomToLoad(e){d.isIntercomInstalled()?(this.connectToIntercom(),e()):setTimeout(()=>{this.waitForIntercomToLoad(e)},L.INTERCOM_INSTALL_CHECK_TIMEOUT_MS)}connectToIntercom(){let e=this.launcher.getInitConfig(),t=new d;e.integrations!=null&&e.integrations.intercom&&e.getCredentials()!=null&&(t.update({"coview-app":this.launcher.getHost()+"/#/direct/start-session/"+e.projectKey+"/"+e.user.id}),t.update({"coview-request":this.launcher.getHost()+"/screen-request/?project-key="+e.projectKey+"&ref-id="+e.user.id}))}setupIntercomWatcher(){let e=this.launcher.getInitConfig();this.intercomWatcher=new f({onRequestFound(){},onUserIdFound:t=>{e.user==null&&(e.user=new E),e.user.id=t,N("set","user",e.user),this.launcher.getLauncherUpdate()},onConversationIdFound:t=>{this.startSendIntercomConversationHeartbeat(t),this.sendIntercomConversationHeartbeat(t)}})}shutdown(){this.intercomWatcher!=null&&this.intercomWatcher.shutdown(),this.intercomHeartbeatHandle!=null&&(clearInterval(this.intercomHeartbeatHandle),this.intercomHeartbeatHandle=null)}startSendIntercomConversationHeartbeat(e){this.intercomHeartbeatConversationId=e,this.intercomHeartbeatHandle==null&&(this.intercomHeartbeatHandle=setInterval(()=>{this.sendIntercomConversationHeartbeat(this.intercomHeartbeatConversationId)},L.INTERCOM_HEARTBEAT_MS))}sendIntercomConversationHeartbeat(e){let t=this.launcher.getHost()+"/api/integration/intercom/heartbeat/"+e,i=new XMLHttpRequest;i.open("GET",t,!0),i.setRequestHeader("Content-type","application/json;charset=UTF-8"),i.send()}},T=L;T.INTERCOM_INSTALL_CHECK_TIMEOUT_MS=3e3,T.INTERCOM_HEARTBEAT_MS=1e4;var m=class{constructor(){this.cookieService=new l;this.urlChangeListenerService=new I;this.scriptInjected=!1;this.retryAfterClearAuthenticationResponse=!1}init(){if(window.coview==null)throw new Error("global coview variable not set");let e=this.getOrCreateCoviewObjectArguments();for(let t=0;t<e.length;t++){let r=e[0][0];if(this.isStopFunctionKey(r)){e.splice(t,1);continue}if(this.isStartFunctionKey(r)){this.initCoview();return}}e.push=t=>{let i=t[0];return this.isStopFunctionKey(i)||(e.splice(e.length,0,t),this.isStartFunctionKey(i)&&this.initCoview()),e.length}}initCoview(){if(this.initConfig=this.createConfig(this.getOrCreateCoviewObjectArguments()),this.initConfig==null)throw new Error("coview init config not found");if(this.initConfig.projectKey==null)throw new Error("coview projectKey not defined");this.host=this.initConfig.hostUrl!=null?this.initConfig.hostUrl:"https://app.coview.com",this.intercomContext=new T(this),this.overwriteConsoleLog(),this.createRootElement(()=>{d.isIntercomInstalled()&&this.intercomContext.connectToIntercom(),this.postInitConfig()})}createConfig(e){let t=new b;for(let i of e){let r=i[0];if(r==="set"||r==="start")if(i.length===2){let n=i[1],a=Object.keys(n);for(let s of a)t[s]=n[s]}else if(i.length===3)t[i[1]]=i[2];else throw new Error("Invalid arguments for coview('"+r+"')")}return b.normalize(t)}createRootElement(e){let t=document.createElement("div");t.id="coview-container",t.className="cov cov-root",t.style.cssText="z-index: 2147483647; position:relative;",document.body!=null?(document.body.appendChild(t),A.createIframe(t),e()):document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(t),A.createIframe(t),e()})}postInitConfig(){let e=this.host+"/api/client-info/launcher";this.post(this.initConfig,e,t=>{if(t.isBlocked){console.log("Coview is disabled.");return}if(t.clearAuthentication){this.handleClearAuthenticationResponse(t);return}if(t.isCustomer&&this.intercomContext.isIntercomEnabled(t)&&!this.intercomContext.isIntercomInstalled()&&!t.loadScript){this.intercomContext.waitForIntercomToLoad(()=>{this.postInitConfig()});return}this.launcherInfo=t,y.setEnabledFeatures(t.enabledFeatures),this.overwriteCoviewArray(),window.coview("set","launcherInfo",t),t.isCustomer?this.tryInjectCustomerScript(t):t.loadScript&&this.injectScript()})}overwriteCoviewArray(){let e=this.getOrCreateCoviewObjectArguments();e.push=t=>(this.handleCoviewArgument(t),e.splice(e.length,0,t),e.length)}handleClearAuthenticationResponse(e){this.cookieService.clearCookie(l.CUSTOMER_JWT_COOKIE_NAME),e.unknownProjectKey?console.log("You entered an invalid project key. Please ensure you entered a correct one."):e.isCustomer?this.retryAfterClearAuthenticationResponse||(this.retryAfterClearAuthenticationResponse=!0,this.postInitConfig()):console.log("Your coview authentication seems out of date. Please refresh the page.")}hideChatButton(){this.initConfig.chat==null&&(this.initConfig.chat=new v),this.initConfig.chat.showButton=!1,window.coview("set","chat",this.initConfig.chat)}tryInjectCustomerScript(e){(this.intercomContext.isIntercomEnabled(e)||this.isChatButtonDisabled(e))&&this.hideChatButton(),e.loadScript||this.isCustomerScriptInjectionAllowed()?this.injectScript():(this.urlChangeListenerService.listenToUrlChange(()=>{this.getLauncherUpdate()}),this.initConfig.canShowButton()&&new R(e.chatInfo.mainColor,!0),this.intercomContext.isIntercomEnabled(e)&&this.intercomContext.setupIntercomWatcher())}isChatButtonDisabled(e){return e.chatInfo!=null&&!e.chatInfo.isChatEnabled}isCustomerScriptInjectionAllowed(){if(window.location.search.indexOf(m.REQUEST_SCREENCAST)!==-1||window.location.search.indexOf(m.REQUEST_SCREENSHOT)!==-1||window.location.search.indexOf(m.REQUEST_COBROWSE)!==-1)return!0;let t=this.getOrCreateCoviewObjectArguments();for(let i of t)if(!this.isNonFunctionKey(i[0]))return!0;return!1}getLauncherUpdate(){let e=this.host+"/api/client-info/launcher-update";this.post(this.initConfig,e,t=>{t!=null&&t.loadScript&&(this.launcherInfo=t,window.coview("set","launcherInfo",this.launcherInfo),this.injectScript())})}overwriteConsoleLog(){if(!this.initConfig.bindConsole)return;let e=window.console.log;window.console.log=function(){let i=arguments[0];i!=null&&window.coview("log",i),e.apply(console,arguments)}}handleCoviewArgument(e){let t=e[0];switch(t){case"updateUser":window.coview("set","user",e[1]);break;case"message":{if(this.scriptInjected||this.launcherInfo==null)break;e[1].data.type===M.TYPE&&this.injectScript();break}default:if(this.scriptInjected||this.launcherInfo==null)break;this.isNonFunctionKey(t)||(this.initConfig.canShowButton()&&new R(this.launcherInfo.chatInfo.mainColor),this.injectScript());break}}injectScript(){A.removeIframe(),this.urlChangeListenerService.removeUrlChangeListener();let e=this.launcherInfo.scriptPath+"?v="+this.launcherInfo.version,t=this.host+e,i=document.createElement("script");i.type="text/javascript",i.src=t,i.setAttribute("crossorigin","anonymous"),i.setAttribute("defer","defer"),document.body!=null?document.head.insertBefore(i,document.head.lastChild):document.addEventListener("DOMContentLoaded",()=>{document.head.insertBefore(i,document.head.lastChild)}),this.scriptInjected=!0,this.intercomContext.shutdown()}post(e,t,i,r){let n=A.createXmlHttpRequest();n.onreadystatechange=()=>{this.handleResponse(n,i,r)},n.open("post",t,!0),n.withCredentials=!1,n.setRequestHeader("Content-type","application/json;charset=UTF-8"),this.cookieService.resolveAndSetCookieSuffix(t,e.jwtCookieSuffix);let a=this.cookieService.getCookie(l.AGENT_FREE_BROWSE_JWT_COOKIE_NAME);if(a!=null)n.setRequestHeader("X-AGENT-FREEBROWSE-TOKEN",a);else{let w=this.cookieService.getCookie(l.CUSTOMER_JWT_COOKIE_NAME);w!=null&&n.setRequestHeader("Authorization","Bearer "+w)}let s=new F;s.agentModeRequest=this.hasAgentRequestModeParam(),s.projectKey=e.projectKey,s.originUrl=window.location.href,s.skipTracking=e.skipTracking==null?!1:e.skipTracking,s.screenSize=screen.width+","+screen.height;let C=e.getCredentials();C!=null&&(C.className=E.CLASS_NAME,s.credentials=C),n.send(j.stringify(s))}handleResponse(e,t,i){e.readyState===4&&e.status===200&&(e.status===200?t!=null&&(e.response.length>0?t(JSON.parse(e.response)):t(null)):(console.log("error on launching coview "+e.status+" : "+e.statusText),i&&i()))}isNonFunctionKey(e){return m.NON_FUNCTION_KEYWORDS.indexOf(e)!==-1}isStopFunctionKey(e){return m.STOP_FUNCTION_KEYWORDS.indexOf(e)!==-1}isStartFunctionKey(e){return m.START_FUNCTION_KEYWORDS.indexOf(e)!==-1}hasAgentRequestModeParam(){return window.location.search.indexOf(m.REQUEST_AGENT_MODE)!==-1}getOrCreateCoviewObjectArguments(){let e=window.coview.a;return e==null&&(e=new Array,window.coview.a=e),e}getInitConfig(){return this.initConfig}getHost(){return this.host}},h=m;h.NON_FUNCTION_KEYWORDS=["set","start","log","error","updateUser","debug","message"],h.STOP_FUNCTION_KEYWORDS=["stop","clearSession"],h.START_FUNCTION_KEYWORDS=["set","start"],h.REQUEST_SCREENSHOT="coview-screenshot",h.REQUEST_SCREENCAST="coview-screencast",h.REQUEST_COBROWSE="coview-screenshare",h.REQUEST_AGENT_MODE="coview-agent-mode";new h().init();})();
